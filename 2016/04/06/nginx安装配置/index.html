	<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>nginx安装配置 | qingyunzhang blog</title>
  <meta name="author" content="qingyunzhang">
  
  <meta name="description" content="java | python">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="nginx安装配置"/>
  <meta property="og:site_name" content="qingyunzhang blog"/>

  
  
		<!-- favicon -->
		<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
		<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.png">
		<meta name="theme-color" content="#009688">
		<!-- favicon end -->
     <link href="/favicon.ico" rel="icon">
  

  <!-- toc -->
  <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css">

  <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">

  <!-- material design -->
	<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css">
  <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
	<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  

  

  <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/libs/jquery-2.0.3.min.js" type="text/javascript"><\/script>')</script>

</head>

 	<body>
	  <nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">菜单</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">qingyunzhang blog</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    <a href="/" title="">
                    <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                <li>
                    <a href="/archives" title="">
                    <i class="fa fa-list"></i>存档
                    </a>
                </li>
                
                <li>
                    <a href="/categories" title="All the categories.">
                    <i class="fa fa-folder"></i>分类
                    </a>
                </li>
                
                <li>
                    <a href="/tags" title="All the tags.">
                    <i class="fa fa-tag"></i>标签
                    </a>
                </li>
                
                <li>
                    <a href="/about" title="">
                    <i class="fa fa-info-circle"></i>关于
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>

	  <div class="container" >
	    <div class="row">
	
	<div class="col-md-9 center-content">
	

		<div class="content">
			<!-- index -->
		   

			  		<h2>nginx安装配置</h2>
					
					<div>
						<span class="post-time">2016-04-06 20:51:27</span>
					</div>	
					

					<div class="article-content">
						<h1 id="nginx安装配置"><a href="#nginx安装配置" class="headerlink" title="nginx安装配置"></a>nginx安装配置</h1><h2 id="1-nginx安装启停命令"><a href="#1-nginx安装启停命令" class="headerlink" title="1. nginx安装启停命令"></a>1. nginx安装启停命令</h2><h5 id="1-1-nginx安装包链接点击这里"><a href="#1-1-nginx安装包链接点击这里" class="headerlink" title="1.1 nginx安装包链接点击这里"></a>1.1 nginx安装包链接点击<a href="https://www.nginx.com/resources/wiki/start/topics/tutorials/install/" target="_blank" rel="external">这里</a></h5><h5 id="1-2-Yum安装："><a href="#1-2-Yum安装：" class="headerlink" title="1.2    Yum安装："></a>1.2    Yum安装：</h5><figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">vim /etc/yum.repos.d/nginx.repo </span><br><span class="line">[nginx] </span><br><span class="line">name=nginx repo </span><br><span class="line">baseurl=http:<span class="regexp">//nginx</span>.org/packages/centos/$releasever/$basearch/ gpg</span><br><span class="line">check=<span class="number">0</span> </span><br><span class="line">enabled=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h5 id="1-3-源码安装-prefix表示安装路径，默认-usr-local-gzip支持文件压缩，pcre支持正则匹配，ssl支持https加密，add-module表示编译三方模块到nginx；安装nginx前linux需安装pcre、openssl和zlib库，或者下载源码在编译nginx时，指定路径到nginx"><a href="#1-3-源码安装-prefix表示安装路径，默认-usr-local-gzip支持文件压缩，pcre支持正则匹配，ssl支持https加密，add-module表示编译三方模块到nginx；安装nginx前linux需安装pcre、openssl和zlib库，或者下载源码在编译nginx时，指定路径到nginx" class="headerlink" title="1.3 源码安装,prefix表示安装路径，默认/usr/local/,gzip支持文件压缩，pcre支持正则匹配，ssl支持https加密，add-module表示编译三方模块到nginx；安装nginx前linux需安装pcre、openssl和zlib库，或者下载源码在编译nginx时，指定路径到nginx"></a>1.3 源码安装,prefix表示安装路径，默认/usr/local/,gzip支持文件压缩，pcre支持正则匹配，ssl支持https加密，add-module表示编译三方模块到nginx；安装nginx前linux需安装pcre、openssl和zlib库，或者下载源码在编译nginx时，指定路径到nginx</h5><p>安装前先安装依赖包：</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">yum -<span class="keyword">y</span> install gcc gcc-c++ make libtool zlib zlib-devel openssl openssl-devel pcre pcre-devel</span><br></pre></td></tr></table></figure>
<p>编译安装如下：</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">tar xvzf nginx-<span class="number">1.9</span>.<span class="number">14</span>.tar.gz</span><br><span class="line">cd nginx-<span class="number">1.9</span>.<span class="number">14</span></span><br><span class="line">./configure --prefix=<span class="regexp">/opt/nginx</span> \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--with-pcre --with-http_stub_status_module \</span><br><span class="line">--add-module= gnosek-nginx-upstream-fair \</span><br><span class="line">--with-http_ssl_module --with-zlib</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h5 id="1-4-更多安装的编译选项点击这里"><a href="#1-4-更多安装的编译选项点击这里" class="headerlink" title="1.4 更多安装的编译选项点击这里"></a>1.4 更多安装的编译选项点击<a href="https://www.nginx.com/resources/wiki/start/topics/tutorials/installoptions/" target="_blank" rel="external">这里</a></h5><h5 id="1-5-安装完成之后启停操作："><a href="#1-5-安装完成之后启停操作：" class="headerlink" title="1.5 安装完成之后启停操作："></a>1.5 安装完成之后启停操作：</h5><figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">/opt/nginx/sbin/nginx</span><br><span class="line">/opt/nginx/sbin/nginx -c /opt/nginx/conf/nginx.conf  <span class="comment">#-c选项启动时指定配置文件</span></span><br><span class="line">ps -ef |<span class="keyword">grep</span> nginx 									 <span class="comment">#查看进程</span></span><br><span class="line">netstat -tlnp|<span class="keyword">grep</span> <span class="number">80</span>								 <span class="comment">#查看端口</span></span><br><span class="line">/opt/nginx/sbin/nginx  -t   						 <span class="comment">#检查配置文件</span></span><br><span class="line">/opt/nginx/sbin/nginx  -<span class="keyword">s</span> reload    				 <span class="comment">#重新加载配置</span></span><br><span class="line">/opt/nginx/sbin/nginx  -<span class="keyword">s</span> stop		(<span class="keyword">kill</span> -HUP pid)</span><br></pre></td></tr></table></figure>
<h2 id="2-nginx配置文件说明"><a href="#2-nginx配置文件说明" class="headerlink" title="2. nginx配置文件说明"></a>2. nginx配置文件说明</h2><h5 id="2-1-全局配置"><a href="#2-1-全局配置" class="headerlink" title="2.1 全局配置"></a>2.1 全局配置</h5><figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="comment">#全局配置项</span></span><br><span class="line">user  nginx nginx; 						<span class="comment">#运行用户和用户组，master进程仍是root权限</span></span><br><span class="line">worker_processes  <span class="number">2</span>;					<span class="comment">#进程数,基本和cpu核数保持一致，最多不要大于8</span></span><br><span class="line">worker_cpu_affinity  <span class="number">01</span> <span class="number">10</span>;				<span class="comment">#内核绑定，在2核的cpu是如此配置</span></span><br><span class="line">worker_rlimit_nofile <span class="number">51200</span>; 			<span class="comment">#设置文件描述符</span></span><br><span class="line">error_log  logs/error.<span class="keyword">log</span>  info; 		<span class="comment">#全局错误日志定义类型</span></span><br><span class="line">pid        logs/nginx.pid;  			<span class="comment">#nginx进程文件</span></span><br><span class="line"><span class="comment">#Events配置项</span></span><br><span class="line"><span class="keyword">use</span> epoll; 								<span class="comment">#高效的I/O模型</span></span><br><span class="line">worker_connections  <span class="number">51200</span>; 				<span class="comment">#每个进程允许最大连接数</span></span><br><span class="line"><span class="comment">#Http配置项</span></span><br><span class="line">对所有的虚拟主机(server)生效</span><br><span class="line"><span class="comment">#Server配置项</span></span><br><span class="line">只对单个虚拟主机(server)生效</span><br></pre></td></tr></table></figure>
<h5 id="2-2-基础配置"><a href="#2-2-基础配置" class="headerlink" title="2.2 基础配置"></a>2.2 基础配置</h5><figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="comment">#log_format,设置输出日志格式：</span></span><br><span class="line">log_format  main   <span class="string">'$remote_addr - $remote_user [$time_local] "$request" $status</span><br><span class="line">$body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line">access_log  logs/access.<span class="keyword">log</span>  main;</span><br><span class="line"><span class="comment">#gzip，设置文件压缩：</span></span><br><span class="line">   gzip on;				<span class="comment">#开启gzip压缩输出，减少网络传输				</span></span><br><span class="line">   gzip_min_length  <span class="number">1</span>k;	<span class="comment">#设置允许压缩的页面最小字节数</span></span><br><span class="line">   gzip_buffers     <span class="number">4</span> <span class="number">16</span>k;	<span class="comment">#设置系统获取几个单位的缓存</span></span><br><span class="line">   gzip_http_version <span class="number">1.1</span>;	<span class="comment">#用于识别 http 协议的版本</span></span><br><span class="line">   gzip_comp_level <span class="number">2</span>;		<span class="comment"># gzip压缩比,1压缩比最小处理速度最快，9压缩比最大但处理速度最慢</span></span><br><span class="line">   gzip_types  text/plain  text/css  application/xml ;   <span class="comment">#匹配mime类型进行压缩</span></span><br><span class="line">server_tokens off; 	<span class="comment">#隐藏服务器的版本号,也可伪造nginx版本信息，src/core/nginx.h中</span></span><br><span class="line">autoindex on; 		<span class="comment">#开启目录列表访问，合适下载服务器，默认关闭</span></span><br><span class="line"><span class="comment">#expires，设置浏览器本地缓存：</span></span><br><span class="line">location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|js|css)$ &#123;</span><br><span class="line">	root /download;</span><br><span class="line">	expires <span class="number">7</span>d; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#与http服务相关一些参数</span></span><br><span class="line">sendfile on;					<span class="comment">#开启高效文件传输模式</span></span><br><span class="line">keepalive_timeout <span class="number">65</span>;			<span class="comment">#长连接超时时间 </span></span><br><span class="line">send_timeout;					<span class="comment">#指定响应客户端的超时时间</span></span><br><span class="line">client_max_body_size <span class="number">10</span><span class="keyword">m</span>;		<span class="comment">#允许客户端请求的最大单文件字节数</span></span><br><span class="line">client_body_buffer_size <span class="number">128</span>k;	<span class="comment">#缓冲区代理缓冲用户端请求的最大字节数</span></span><br><span class="line"><span class="comment">#访问控制 allow/deny</span></span><br><span class="line">location /nginxstatus &#123;</span><br><span class="line">	stub_status on;</span><br><span class="line">	access_log off;</span><br><span class="line">	allow <span class="number">192.168</span>.<span class="number">1.1</span>;</span><br><span class="line">	deny all;</span><br><span class="line">&#125;						<span class="comment">#只允许IP为 192.168.1.1访问地址 /nginxstatus/查看nignx当前状态</span></span><br></pre></td></tr></table></figure>
<h2 id="3-nginx中location匹配规则"><a href="#3-nginx中location匹配规则" class="headerlink" title="3. nginx中location匹配规则"></a>3. nginx中location匹配规则</h2><h5 id="3-1-语法"><a href="#3-1-语法" class="headerlink" title="3.1 语法"></a>3.1 语法</h5><p>location [ =|~|~*|^~|@ ]  /uri/ { … }</p>
<h5 id="3-2-匹配原则"><a href="#3-2-匹配原则" class="headerlink" title="3.2 匹配原则"></a>3.2 匹配原则</h5><p>先普通 location ，再匹配正则 location    =   ^~  uri  ~   ~<em><br>@为内部匹配，外面请求调不通<br>详细说明：先遍历普通location，如匹配到=的uri，终止匹配；如无匹配到=，遍历匹配^~的uri，如匹配到，终止匹配；如有多条匹配结果，取最长的一条匹配规则，此处不终止匹配，继续遍历~和~</em>的location，匹配第一条后终止，如若未匹配到，选取上面最长的一条匹配规则</p>
<h5 id="3-3-实例"><a href="#3-3-实例" class="headerlink" title="3.3 实例"></a>3.3 实例</h5><figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">location = <span class="regexp">/ &#123;</span><br><span class="line">   	   	/</span> 匹配	</span><br><span class="line">   &#125;</span><br><span class="line">location / &#123;</span><br><span class="line">   	     <span class="regexp">/index.html匹配到 </span><br><span class="line">&#125;</span><br><span class="line">location /documents</span><span class="regexp">/ &#123;</span><br><span class="line">   	     /documents</span><span class="regexp">/documents.html匹配到</span><br><span class="line">&#125;</span><br><span class="line">location ^~ /images</span><span class="regexp">/ &#123;</span><br><span class="line">   	    /images</span><span class="regexp">/1.jsp匹配到</span><br><span class="line">  	&#125;</span><br><span class="line">location ~* \.(gif|jpg|jpeg)$ &#123;</span><br><span class="line">  	    	/documents</span><span class="regexp">/1.jsp匹配到</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="4-nginx中rewrite模块"><a href="#4-nginx中rewrite模块" class="headerlink" title="4. nginx中rewrite模块"></a>4. nginx中rewrite模块</h2><h5 id="4-1-URL重写"><a href="#4-1-URL重写" class="headerlink" title="4.1 URL重写"></a>4.1 URL重写</h5><p>~ 区分大小写<br>~* 不区分大小写</p>
<h5 id="4-2-条件判断"><a href="#4-2-条件判断" class="headerlink" title="4.2 条件判断"></a>4.2 条件判断</h5><p>-f和!-f用来判断是否存在文件<br>-d和!-d用来判断是否存在目录<br>-e和!-e用来判断是否存在文件或目录<br>-x和!-x用来判断文件是否可执行</p>
<h5 id="4-3-标记"><a href="#4-3-标记" class="headerlink" title="4.3 标记"></a>4.3 标记</h5><p>last(持续匹配)；break(匹配一次后终止)<br>redirect；permanent  ;临时(302)/永久(301)重定向</p>
<h5 id="4-4-Nginx-变量"><a href="#4-4-Nginx-变量" class="headerlink" title="4.4 Nginx 变量"></a>4.4 Nginx 变量</h5><figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">$args :						<span class="comment">#这个变量等于请求行中的参数，同$query_string</span></span><br><span class="line">$content_length : 			<span class="comment">#请求头中的Content-length字段</span></span><br><span class="line">$content_type :				<span class="comment">#请求头中的Content-Type字段</span></span><br><span class="line">$document_root : 			<span class="comment">#当前请求在root指令中指定的值</span></span><br><span class="line">$host : 					<span class="comment">#请求主机头字段，否则为服务器名称</span></span><br><span class="line">$http_user_agent :	 		<span class="comment">#客户端agent信息</span></span><br><span class="line">$http_cookie :	 			<span class="comment">#客户端cookie信息</span></span><br><span class="line">$limit_rate :				<span class="comment">#这个变量可以限制连接速率</span></span><br><span class="line">$request_method : 			<span class="comment">#客户端请求的动作，通常为GET或POST</span></span><br><span class="line">$remote_addr :				<span class="comment">#客户端的IP地址</span></span><br><span class="line">$remote_port :				<span class="comment">#客户端的端口</span></span><br><span class="line">$remote_user :				<span class="comment">#已经经过Auth Basic Module验证的用户名。</span></span><br><span class="line">$request_filename : 		<span class="comment">#当前请求的文件路径，由root或alias指令与URI请求生成</span></span><br><span class="line">$scheme :					<span class="comment">#HTTP方法（如http，https）</span></span><br><span class="line">$server_protocol :	 		<span class="comment">#请求使用的协议，通常是HTTP/1.0或HTTP/1.1</span></span><br><span class="line">$server_addr :	 			<span class="comment">#服务器地址，在完成一次系统调用后可以确定这个值</span></span><br><span class="line">$server_name :				<span class="comment">#服务器名称</span></span><br><span class="line">$server_port :	 			<span class="comment">#请求到达服务器的端口号</span></span><br><span class="line">$request_uri :				<span class="comment">#包含请求参数的原始URI，不包含主机名，如：”/login.jsp?usr=abc”</span></span><br><span class="line">$uri :	 					<span class="comment">#不带请求参数的当前URI，$uri不包含主机名，如”/login.jsp”</span></span><br><span class="line">$document_uri :				<span class="comment">#与$uri相同。</span></span><br></pre></td></tr></table></figure>
<h5 id="4-5-正则标识"><a href="#4-5-正则标识" class="headerlink" title="4.5 正则标识"></a>4.5 正则标识</h5><figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">	. :		<span class="comment">#匹配除换行符以外的任意字符</span></span><br><span class="line">	? : 	<span class="comment">#重复0次或1次</span></span><br><span class="line">	+ : 	<span class="comment">#重复1次或更多次</span></span><br><span class="line">	* : 	<span class="comment">#重复0次或更多次</span></span><br><span class="line">	\d :	<span class="comment">#匹配数字</span></span><br><span class="line">	^ : 	<span class="comment">#匹配字符串的开始</span></span><br><span class="line">	$ : 	<span class="comment">#匹配字符串的介绍</span></span><br><span class="line">	<span class="string">&#123;n&#125;</span> : 	<span class="comment">#重复n次</span></span><br><span class="line">	&#123;n,&#125; : 	<span class="comment">#重复n次或更多次</span></span><br><span class="line">	[c] : 	<span class="comment">#匹配单个字符c</span></span><br><span class="line">	[a-z] : <span class="comment">#匹配a-z小写字母的任意一个</span></span><br><span class="line">小括号()之间匹配的内容,可以在后面通过$1来引用,$2表示的是前面第二个()里的内容,\是转义特殊字符</span><br></pre></td></tr></table></figure>
<h5 id="4-6-If-语句"><a href="#4-6-If-语句" class="headerlink" title="4.6 If 语句"></a>4.6 If 语句</h5><figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ($uri ~* ^<span class="regexp">/(auth/tologin</span>|auth/loginsubmit)$ ) &#123;</span><br><span class="line">               rewrite ^(.*)$ https:<span class="regexp">//</span>$host$1 permanent;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

					</div>

			  <!-- about -->
			  
		</div>

		<!-- pagination -->
	  

		<div class="comment-section">
  
  


</div>
	</div>

	

</div>


		<footer>
			 

<p>
  Power by <a href="https://hexo.io">hexo</a> | themed by <a href="https://github.com/wayou/hexo-theme-material">material</a> |
</p>
<p>
  2016 <a href="http://Seven-zhang.github.io"> qingyunzhang </a>
</p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>


		</footer>
	  </div>

		<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>

		<!-- material design -->
		<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script>
		<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>
		<!-- toc -->
		<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
		<script src="/libs/tocify/jquery.tocify.custom.js"></script>

		<script src="/js/main.js"></script>

	</body>
</html>
